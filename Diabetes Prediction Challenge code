{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "575ad7ec",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:18.464603Z",
     "iopub.status.busy": "2025-12-30T18:13:18.464291Z",
     "iopub.status.idle": "2025-12-30T18:13:27.443533Z",
     "shell.execute_reply": "2025-12-30T18:13:27.442761Z"
    },
    "papermill": {
     "duration": 8.984792,
     "end_time": "2025-12-30T18:13:27.445376",
     "exception": false,
     "start_time": "2025-12-30T18:13:18.460584",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/query.py:195: SyntaxWarning: \"is not\" with 'tuple' literal. Did you mean \"!=\"?\n",
      "  if entities is not ():\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import lightgbm as lgb\n",
    "import xgboost as xgb\n",
    "from sklearn.model_selection import StratifiedKFold\n",
    "from sklearn.metrics import roc_auc_score\n",
    "import warnings\n",
    "\n",
    "# 1. CLEANUP: Suppress SyntaxWarnings\n",
    "warnings.filterwarnings(\"ignore\", category=SyntaxWarning)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "7106f37d",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:27.450985Z",
     "iopub.status.busy": "2025-12-30T18:13:27.450127Z",
     "iopub.status.idle": "2025-12-30T18:13:30.164145Z",
     "shell.execute_reply": "2025-12-30T18:13:30.163529Z"
    },
    "papermill": {
     "duration": 2.718314,
     "end_time": "2025-12-30T18:13:30.165845",
     "exception": false,
     "start_time": "2025-12-30T18:13:27.447531",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Loading data...\n"
     ]
    }
   ],
   "source": [
    "# -----------------------------\n",
    "# 2. LOAD DATA\n",
    "# -----------------------------\n",
    "print(\"Loading data...\")\n",
    "train = pd.read_csv(\"/kaggle/input/playground-series-s5e12/train.csv\")\n",
    "test = pd.read_csv(\"/kaggle/input/playground-series-s5e12/test.csv\")\n",
    "\n",
    "TARGET = \"diagnosed_diabetes\"\n",
    "ID_COL = \"id\"\n",
    "\n",
    "X = train.drop(columns=[TARGET])\n",
    "y = train[TARGET]\n",
    "X_test = test.copy()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "b77e0c6c",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:30.171156Z",
     "iopub.status.busy": "2025-12-30T18:13:30.170712Z",
     "iopub.status.idle": "2025-12-30T18:13:30.852343Z",
     "shell.execute_reply": "2025-12-30T18:13:30.851611Z"
    },
    "papermill": {
     "duration": 0.686078,
     "end_time": "2025-12-30T18:13:30.854043",
     "exception": false,
     "start_time": "2025-12-30T18:13:30.167965",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "--- Train Sample ---\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>age</th>\n",
       "      <th>alcohol_consumption_per_week</th>\n",
       "      <th>physical_activity_minutes_per_week</th>\n",
       "      <th>diet_score</th>\n",
       "      <th>sleep_hours_per_day</th>\n",
       "      <th>screen_time_hours_per_day</th>\n",
       "      <th>bmi</th>\n",
       "      <th>waist_to_hip_ratio</th>\n",
       "      <th>systolic_bp</th>\n",
       "      <th>...</th>\n",
       "      <th>gender</th>\n",
       "      <th>ethnicity</th>\n",
       "      <th>education_level</th>\n",
       "      <th>income_level</th>\n",
       "      <th>smoking_status</th>\n",
       "      <th>employment_status</th>\n",
       "      <th>family_history_diabetes</th>\n",
       "      <th>hypertension_history</th>\n",
       "      <th>cardiovascular_history</th>\n",
       "      <th>diagnosed_diabetes</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>31</td>\n",
       "      <td>1</td>\n",
       "      <td>45</td>\n",
       "      <td>7.7</td>\n",
       "      <td>6.8</td>\n",
       "      <td>6.1</td>\n",
       "      <td>33.4</td>\n",
       "      <td>0.93</td>\n",
       "      <td>112</td>\n",
       "      <td>...</td>\n",
       "      <td>Female</td>\n",
       "      <td>Hispanic</td>\n",
       "      <td>Highschool</td>\n",
       "      <td>Lower-Middle</td>\n",
       "      <td>Current</td>\n",
       "      <td>Employed</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>50</td>\n",
       "      <td>2</td>\n",
       "      <td>73</td>\n",
       "      <td>5.7</td>\n",
       "      <td>6.5</td>\n",
       "      <td>5.8</td>\n",
       "      <td>23.8</td>\n",
       "      <td>0.83</td>\n",
       "      <td>120</td>\n",
       "      <td>...</td>\n",
       "      <td>Female</td>\n",
       "      <td>White</td>\n",
       "      <td>Highschool</td>\n",
       "      <td>Upper-Middle</td>\n",
       "      <td>Never</td>\n",
       "      <td>Employed</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "      <td>32</td>\n",
       "      <td>3</td>\n",
       "      <td>158</td>\n",
       "      <td>8.5</td>\n",
       "      <td>7.4</td>\n",
       "      <td>9.1</td>\n",
       "      <td>24.1</td>\n",
       "      <td>0.83</td>\n",
       "      <td>95</td>\n",
       "      <td>...</td>\n",
       "      <td>Male</td>\n",
       "      <td>Hispanic</td>\n",
       "      <td>Highschool</td>\n",
       "      <td>Lower-Middle</td>\n",
       "      <td>Never</td>\n",
       "      <td>Retired</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>54</td>\n",
       "      <td>3</td>\n",
       "      <td>77</td>\n",
       "      <td>4.6</td>\n",
       "      <td>7.0</td>\n",
       "      <td>9.2</td>\n",
       "      <td>26.6</td>\n",
       "      <td>0.83</td>\n",
       "      <td>121</td>\n",
       "      <td>...</td>\n",
       "      <td>Female</td>\n",
       "      <td>White</td>\n",
       "      <td>Highschool</td>\n",
       "      <td>Lower-Middle</td>\n",
       "      <td>Current</td>\n",
       "      <td>Employed</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>4</td>\n",
       "      <td>54</td>\n",
       "      <td>1</td>\n",
       "      <td>55</td>\n",
       "      <td>5.7</td>\n",
       "      <td>6.2</td>\n",
       "      <td>5.1</td>\n",
       "      <td>28.8</td>\n",
       "      <td>0.90</td>\n",
       "      <td>108</td>\n",
       "      <td>...</td>\n",
       "      <td>Male</td>\n",
       "      <td>White</td>\n",
       "      <td>Highschool</td>\n",
       "      <td>Upper-Middle</td>\n",
       "      <td>Never</td>\n",
       "      <td>Retired</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 26 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   id  age  alcohol_consumption_per_week  physical_activity_minutes_per_week  \\\n",
       "0   0   31                             1                                  45   \n",
       "1   1   50                             2                                  73   \n",
       "2   2   32                             3                                 158   \n",
       "3   3   54                             3                                  77   \n",
       "4   4   54                             1                                  55   \n",
       "\n",
       "   diet_score  sleep_hours_per_day  screen_time_hours_per_day   bmi  \\\n",
       "0         7.7                  6.8                        6.1  33.4   \n",
       "1         5.7                  6.5                        5.8  23.8   \n",
       "2         8.5                  7.4                        9.1  24.1   \n",
       "3         4.6                  7.0                        9.2  26.6   \n",
       "4         5.7                  6.2                        5.1  28.8   \n",
       "\n",
       "   waist_to_hip_ratio  systolic_bp  ...  gender  ethnicity  education_level  \\\n",
       "0                0.93          112  ...  Female   Hispanic       Highschool   \n",
       "1                0.83          120  ...  Female      White       Highschool   \n",
       "2                0.83           95  ...    Male   Hispanic       Highschool   \n",
       "3                0.83          121  ...  Female      White       Highschool   \n",
       "4                0.90          108  ...    Male      White       Highschool   \n",
       "\n",
       "   income_level  smoking_status  employment_status family_history_diabetes  \\\n",
       "0  Lower-Middle         Current           Employed                       0   \n",
       "1  Upper-Middle           Never           Employed                       0   \n",
       "2  Lower-Middle           Never            Retired                       0   \n",
       "3  Lower-Middle         Current           Employed                       0   \n",
       "4  Upper-Middle           Never            Retired                       0   \n",
       "\n",
       "  hypertension_history cardiovascular_history diagnosed_diabetes  \n",
       "0                    0                      0                1.0  \n",
       "1                    0                      0                1.0  \n",
       "2                    0                      0                0.0  \n",
       "3                    1                      0                1.0  \n",
       "4                    1                      0                1.0  \n",
       "\n",
       "[5 rows x 26 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "--- Train Info ---\n",
      "<class 'pandas.core.frame.DataFrame'>\n",
      "RangeIndex: 700000 entries, 0 to 699999\n",
      "Data columns (total 26 columns):\n",
      " #   Column                              Non-Null Count   Dtype  \n",
      "---  ------                              --------------   -----  \n",
      " 0   id                                  700000 non-null  int64  \n",
      " 1   age                                 700000 non-null  int64  \n",
      " 2   alcohol_consumption_per_week        700000 non-null  int64  \n",
      " 3   physical_activity_minutes_per_week  700000 non-null  int64  \n",
      " 4   diet_score                          700000 non-null  float64\n",
      " 5   sleep_hours_per_day                 700000 non-null  float64\n",
      " 6   screen_time_hours_per_day           700000 non-null  float64\n",
      " 7   bmi                                 700000 non-null  float64\n",
      " 8   waist_to_hip_ratio                  700000 non-null  float64\n",
      " 9   systolic_bp                         700000 non-null  int64  \n",
      " 10  diastolic_bp                        700000 non-null  int64  \n",
      " 11  heart_rate                          700000 non-null  int64  \n",
      " 12  cholesterol_total                   700000 non-null  int64  \n",
      " 13  hdl_cholesterol                     700000 non-null  int64  \n",
      " 14  ldl_cholesterol                     700000 non-null  int64  \n",
      " 15  triglycerides                       700000 non-null  int64  \n",
      " 16  gender                              700000 non-null  object \n",
      " 17  ethnicity                           700000 non-null  object \n",
      " 18  education_level                     700000 non-null  object \n",
      " 19  income_level                        700000 non-null  object \n",
      " 20  smoking_status                      700000 non-null  object \n",
      " 21  employment_status                   700000 non-null  object \n",
      " 22  family_history_diabetes             700000 non-null  int64  \n",
      " 23  hypertension_history                700000 non-null  int64  \n",
      " 24  cardiovascular_history              700000 non-null  int64  \n",
      " 25  diagnosed_diabetes                  700000 non-null  float64\n",
      "dtypes: float64(6), int64(14), object(6)\n",
      "memory usage: 138.9+ MB\n",
      "\n",
      "--- Summary Statistics ---\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>age</th>\n",
       "      <th>alcohol_consumption_per_week</th>\n",
       "      <th>physical_activity_minutes_per_week</th>\n",
       "      <th>diet_score</th>\n",
       "      <th>sleep_hours_per_day</th>\n",
       "      <th>screen_time_hours_per_day</th>\n",
       "      <th>bmi</th>\n",
       "      <th>waist_to_hip_ratio</th>\n",
       "      <th>systolic_bp</th>\n",
       "      <th>diastolic_bp</th>\n",
       "      <th>heart_rate</th>\n",
       "      <th>cholesterol_total</th>\n",
       "      <th>hdl_cholesterol</th>\n",
       "      <th>ldl_cholesterol</th>\n",
       "      <th>triglycerides</th>\n",
       "      <th>family_history_diabetes</th>\n",
       "      <th>hypertension_history</th>\n",
       "      <th>cardiovascular_history</th>\n",
       "      <th>diagnosed_diabetes</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "      <td>700000.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>349999.500000</td>\n",
       "      <td>50.359734</td>\n",
       "      <td>2.072411</td>\n",
       "      <td>80.230803</td>\n",
       "      <td>5.963695</td>\n",
       "      <td>7.002200</td>\n",
       "      <td>6.012733</td>\n",
       "      <td>25.874684</td>\n",
       "      <td>0.858766</td>\n",
       "      <td>116.294193</td>\n",
       "      <td>75.440924</td>\n",
       "      <td>70.167749</td>\n",
       "      <td>186.818801</td>\n",
       "      <td>53.823214</td>\n",
       "      <td>102.905854</td>\n",
       "      <td>123.081850</td>\n",
       "      <td>0.149401</td>\n",
       "      <td>0.181990</td>\n",
       "      <td>0.030324</td>\n",
       "      <td>0.623296</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>202072.738554</td>\n",
       "      <td>11.655520</td>\n",
       "      <td>1.048189</td>\n",
       "      <td>51.195071</td>\n",
       "      <td>1.463336</td>\n",
       "      <td>0.901907</td>\n",
       "      <td>2.022707</td>\n",
       "      <td>2.860705</td>\n",
       "      <td>0.037980</td>\n",
       "      <td>11.010390</td>\n",
       "      <td>6.825775</td>\n",
       "      <td>6.938722</td>\n",
       "      <td>16.730832</td>\n",
       "      <td>8.266545</td>\n",
       "      <td>19.022416</td>\n",
       "      <td>24.739397</td>\n",
       "      <td>0.356484</td>\n",
       "      <td>0.385837</td>\n",
       "      <td>0.171478</td>\n",
       "      <td>0.484560</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>19.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.100000</td>\n",
       "      <td>3.100000</td>\n",
       "      <td>0.600000</td>\n",
       "      <td>15.100000</td>\n",
       "      <td>0.680000</td>\n",
       "      <td>91.000000</td>\n",
       "      <td>51.000000</td>\n",
       "      <td>42.000000</td>\n",
       "      <td>117.000000</td>\n",
       "      <td>21.000000</td>\n",
       "      <td>51.000000</td>\n",
       "      <td>31.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>174999.750000</td>\n",
       "      <td>42.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>49.000000</td>\n",
       "      <td>5.000000</td>\n",
       "      <td>6.400000</td>\n",
       "      <td>4.600000</td>\n",
       "      <td>23.900000</td>\n",
       "      <td>0.830000</td>\n",
       "      <td>108.000000</td>\n",
       "      <td>71.000000</td>\n",
       "      <td>65.000000</td>\n",
       "      <td>175.000000</td>\n",
       "      <td>48.000000</td>\n",
       "      <td>89.000000</td>\n",
       "      <td>106.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>349999.500000</td>\n",
       "      <td>50.000000</td>\n",
       "      <td>2.000000</td>\n",
       "      <td>71.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>6.000000</td>\n",
       "      <td>25.900000</td>\n",
       "      <td>0.860000</td>\n",
       "      <td>116.000000</td>\n",
       "      <td>75.000000</td>\n",
       "      <td>70.000000</td>\n",
       "      <td>187.000000</td>\n",
       "      <td>54.000000</td>\n",
       "      <td>103.000000</td>\n",
       "      <td>123.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>524999.250000</td>\n",
       "      <td>58.000000</td>\n",
       "      <td>3.000000</td>\n",
       "      <td>96.000000</td>\n",
       "      <td>7.000000</td>\n",
       "      <td>7.600000</td>\n",
       "      <td>7.400000</td>\n",
       "      <td>27.800000</td>\n",
       "      <td>0.880000</td>\n",
       "      <td>124.000000</td>\n",
       "      <td>80.000000</td>\n",
       "      <td>75.000000</td>\n",
       "      <td>199.000000</td>\n",
       "      <td>59.000000</td>\n",
       "      <td>116.000000</td>\n",
       "      <td>139.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>699999.000000</td>\n",
       "      <td>89.000000</td>\n",
       "      <td>9.000000</td>\n",
       "      <td>747.000000</td>\n",
       "      <td>9.900000</td>\n",
       "      <td>9.900000</td>\n",
       "      <td>16.500000</td>\n",
       "      <td>38.400000</td>\n",
       "      <td>1.050000</td>\n",
       "      <td>163.000000</td>\n",
       "      <td>104.000000</td>\n",
       "      <td>101.000000</td>\n",
       "      <td>289.000000</td>\n",
       "      <td>90.000000</td>\n",
       "      <td>205.000000</td>\n",
       "      <td>290.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                  id            age  alcohol_consumption_per_week  \\\n",
       "count  700000.000000  700000.000000                 700000.000000   \n",
       "mean   349999.500000      50.359734                      2.072411   \n",
       "std    202072.738554      11.655520                      1.048189   \n",
       "min         0.000000      19.000000                      1.000000   \n",
       "25%    174999.750000      42.000000                      1.000000   \n",
       "50%    349999.500000      50.000000                      2.000000   \n",
       "75%    524999.250000      58.000000                      3.000000   \n",
       "max    699999.000000      89.000000                      9.000000   \n",
       "\n",
       "       physical_activity_minutes_per_week     diet_score  sleep_hours_per_day  \\\n",
       "count                       700000.000000  700000.000000        700000.000000   \n",
       "mean                            80.230803       5.963695             7.002200   \n",
       "std                             51.195071       1.463336             0.901907   \n",
       "min                              1.000000       0.100000             3.100000   \n",
       "25%                             49.000000       5.000000             6.400000   \n",
       "50%                             71.000000       6.000000             7.000000   \n",
       "75%                             96.000000       7.000000             7.600000   \n",
       "max                            747.000000       9.900000             9.900000   \n",
       "\n",
       "       screen_time_hours_per_day            bmi  waist_to_hip_ratio  \\\n",
       "count              700000.000000  700000.000000       700000.000000   \n",
       "mean                    6.012733      25.874684            0.858766   \n",
       "std                     2.022707       2.860705            0.037980   \n",
       "min                     0.600000      15.100000            0.680000   \n",
       "25%                     4.600000      23.900000            0.830000   \n",
       "50%                     6.000000      25.900000            0.860000   \n",
       "75%                     7.400000      27.800000            0.880000   \n",
       "max                    16.500000      38.400000            1.050000   \n",
       "\n",
       "         systolic_bp   diastolic_bp     heart_rate  cholesterol_total  \\\n",
       "count  700000.000000  700000.000000  700000.000000      700000.000000   \n",
       "mean      116.294193      75.440924      70.167749         186.818801   \n",
       "std        11.010390       6.825775       6.938722          16.730832   \n",
       "min        91.000000      51.000000      42.000000         117.000000   \n",
       "25%       108.000000      71.000000      65.000000         175.000000   \n",
       "50%       116.000000      75.000000      70.000000         187.000000   \n",
       "75%       124.000000      80.000000      75.000000         199.000000   \n",
       "max       163.000000     104.000000     101.000000         289.000000   \n",
       "\n",
       "       hdl_cholesterol  ldl_cholesterol  triglycerides  \\\n",
       "count    700000.000000    700000.000000  700000.000000   \n",
       "mean         53.823214       102.905854     123.081850   \n",
       "std           8.266545        19.022416      24.739397   \n",
       "min          21.000000        51.000000      31.000000   \n",
       "25%          48.000000        89.000000     106.000000   \n",
       "50%          54.000000       103.000000     123.000000   \n",
       "75%          59.000000       116.000000     139.000000   \n",
       "max          90.000000       205.000000     290.000000   \n",
       "\n",
       "       family_history_diabetes  hypertension_history  cardiovascular_history  \\\n",
       "count            700000.000000         700000.000000           700000.000000   \n",
       "mean                  0.149401              0.181990                0.030324   \n",
       "std                   0.356484              0.385837                0.171478   \n",
       "min                   0.000000              0.000000                0.000000   \n",
       "25%                   0.000000              0.000000                0.000000   \n",
       "50%                   0.000000              0.000000                0.000000   \n",
       "75%                   0.000000              0.000000                0.000000   \n",
       "max                   1.000000              1.000000                1.000000   \n",
       "\n",
       "       diagnosed_diabetes  \n",
       "count       700000.000000  \n",
       "mean             0.623296  \n",
       "std              0.484560  \n",
       "min              0.000000  \n",
       "25%              0.000000  \n",
       "50%              1.000000  \n",
       "75%              1.000000  \n",
       "max              1.000000  "
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "--- Target Distribution ---\n",
      "diagnosed_diabetes\n",
      "1.0    0.623296\n",
      "0.0    0.376704\n",
      "Name: proportion, dtype: float64\n"
     ]
    }
   ],
   "source": [
    "# View the first 5 rows of the training data\n",
    "print(\"--- Train Sample ---\")\n",
    "display(train.head())\n",
    "\n",
    "# Check the data types and missing values\n",
    "print(\"\\n--- Train Info ---\")\n",
    "train.info()\n",
    "\n",
    "# Summary statistics for numerical columns\n",
    "print(\"\\n--- Summary Statistics ---\")\n",
    "display(train.describe())\n",
    "\n",
    "# Check target distribution\n",
    "print(\"\\n--- Target Distribution ---\")\n",
    "print(train[TARGET].value_counts(normalize=True))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "2ce0c12f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:30.860372Z",
     "iopub.status.busy": "2025-12-30T18:13:30.860110Z",
     "iopub.status.idle": "2025-12-30T18:13:32.177665Z",
     "shell.execute_reply": "2025-12-30T18:13:32.176980Z"
    },
    "papermill": {
     "duration": 1.32261,
     "end_time": "2025-12-30T18:13:32.179373",
     "exception": false,
     "start_time": "2025-12-30T18:13:30.856763",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Applying feature engineering...\n"
     ]
    }
   ],
   "source": [
    "# -----------------------------\n",
    "# 3. FEATURE ENGINEERING\n",
    "# -----------------------------\n",
    "def feature_engineering(df):\n",
    "    df = df.copy()\n",
    "    num_cols = df.select_dtypes(include=[np.number]).columns.tolist()\n",
    "    if ID_COL in num_cols:\n",
    "        num_cols.remove(ID_COL)\n",
    "\n",
    "    for col in num_cols:\n",
    "        df[f\"{col}_sq\"] = df[col] ** 2\n",
    "        if df[col].min() >= 0:\n",
    "            df[f\"{col}_log\"] = np.log1p(df[col])\n",
    "\n",
    "    # Row-based stats\n",
    "    df[\"row_mean\"] = df[num_cols].mean(axis=1)\n",
    "    df[\"row_std\"] = df[num_cols].std(axis=1)\n",
    "    df[\"row_max\"] = df[num_cols].max(axis=1)\n",
    "    df[\"row_min\"] = df[num_cols].min(axis=1)\n",
    "    return df\n",
    "\n",
    "print(\"Applying feature engineering...\")\n",
    "X = feature_engineering(X)\n",
    "X_test = feature_engineering(X_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "c23bed5e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:32.185956Z",
     "iopub.status.busy": "2025-12-30T18:13:32.185698Z",
     "iopub.status.idle": "2025-12-30T18:13:32.344196Z",
     "shell.execute_reply": "2025-12-30T18:13:32.343482Z"
    },
    "papermill": {
     "duration": 0.163621,
     "end_time": "2025-12-30T18:13:32.345832",
     "exception": false,
     "start_time": "2025-12-30T18:13:32.182211",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "New shape of X: (700000, 65)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>age</th>\n",
       "      <th>alcohol_consumption_per_week</th>\n",
       "      <th>physical_activity_minutes_per_week</th>\n",
       "      <th>diet_score</th>\n",
       "      <th>sleep_hours_per_day</th>\n",
       "      <th>screen_time_hours_per_day</th>\n",
       "      <th>bmi</th>\n",
       "      <th>waist_to_hip_ratio</th>\n",
       "      <th>systolic_bp</th>\n",
       "      <th>...</th>\n",
       "      <th>family_history_diabetes_sq</th>\n",
       "      <th>family_history_diabetes_log</th>\n",
       "      <th>hypertension_history_sq</th>\n",
       "      <th>hypertension_history_log</th>\n",
       "      <th>cardiovascular_history_sq</th>\n",
       "      <th>cardiovascular_history_log</th>\n",
       "      <th>row_mean</th>\n",
       "      <th>row_std</th>\n",
       "      <th>row_max</th>\n",
       "      <th>row_min</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>31</td>\n",
       "      <td>1</td>\n",
       "      <td>45</td>\n",
       "      <td>7.7</td>\n",
       "      <td>6.8</td>\n",
       "      <td>6.1</td>\n",
       "      <td>33.4</td>\n",
       "      <td>0.93</td>\n",
       "      <td>112</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>47.162778</td>\n",
       "      <td>55.232806</td>\n",
       "      <td>199.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>50</td>\n",
       "      <td>2</td>\n",
       "      <td>73</td>\n",
       "      <td>5.7</td>\n",
       "      <td>6.5</td>\n",
       "      <td>5.8</td>\n",
       "      <td>23.8</td>\n",
       "      <td>0.83</td>\n",
       "      <td>120</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>51.646111</td>\n",
       "      <td>58.402626</td>\n",
       "      <td>199.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2</td>\n",
       "      <td>32</td>\n",
       "      <td>3</td>\n",
       "      <td>158</td>\n",
       "      <td>8.5</td>\n",
       "      <td>7.4</td>\n",
       "      <td>9.1</td>\n",
       "      <td>24.1</td>\n",
       "      <td>0.83</td>\n",
       "      <td>95</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>53.829444</td>\n",
       "      <td>59.602287</td>\n",
       "      <td>188.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>3</td>\n",
       "      <td>54</td>\n",
       "      <td>3</td>\n",
       "      <td>77</td>\n",
       "      <td>4.6</td>\n",
       "      <td>7.0</td>\n",
       "      <td>9.2</td>\n",
       "      <td>26.6</td>\n",
       "      <td>0.83</td>\n",
       "      <td>121</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>49.512778</td>\n",
       "      <td>53.612321</td>\n",
       "      <td>182.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>4</td>\n",
       "      <td>54</td>\n",
       "      <td>1</td>\n",
       "      <td>55</td>\n",
       "      <td>5.7</td>\n",
       "      <td>6.2</td>\n",
       "      <td>5.1</td>\n",
       "      <td>28.8</td>\n",
       "      <td>0.90</td>\n",
       "      <td>108</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>51.150000</td>\n",
       "      <td>59.230052</td>\n",
       "      <td>206.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 65 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   id  age  alcohol_consumption_per_week  physical_activity_minutes_per_week  \\\n",
       "0   0   31                             1                                  45   \n",
       "1   1   50                             2                                  73   \n",
       "2   2   32                             3                                 158   \n",
       "3   3   54                             3                                  77   \n",
       "4   4   54                             1                                  55   \n",
       "\n",
       "   diet_score  sleep_hours_per_day  screen_time_hours_per_day   bmi  \\\n",
       "0         7.7                  6.8                        6.1  33.4   \n",
       "1         5.7                  6.5                        5.8  23.8   \n",
       "2         8.5                  7.4                        9.1  24.1   \n",
       "3         4.6                  7.0                        9.2  26.6   \n",
       "4         5.7                  6.2                        5.1  28.8   \n",
       "\n",
       "   waist_to_hip_ratio  systolic_bp  ...  family_history_diabetes_sq  \\\n",
       "0                0.93          112  ...                           0   \n",
       "1                0.83          120  ...                           0   \n",
       "2                0.83           95  ...                           0   \n",
       "3                0.83          121  ...                           0   \n",
       "4                0.90          108  ...                           0   \n",
       "\n",
       "   family_history_diabetes_log  hypertension_history_sq  \\\n",
       "0                          0.0                        0   \n",
       "1                          0.0                        0   \n",
       "2                          0.0                        0   \n",
       "3                          0.0                        1   \n",
       "4                          0.0                        1   \n",
       "\n",
       "   hypertension_history_log  cardiovascular_history_sq  \\\n",
       "0                  0.000000                          0   \n",
       "1                  0.000000                          0   \n",
       "2                  0.000000                          0   \n",
       "3                  0.693147                          0   \n",
       "4                  0.693147                          0   \n",
       "\n",
       "   cardiovascular_history_log   row_mean    row_std row_max row_min  \n",
       "0                         0.0  47.162778  55.232806   199.0     0.0  \n",
       "1                         0.0  51.646111  58.402626   199.0     0.0  \n",
       "2                         0.0  53.829444  59.602287   188.0     0.0  \n",
       "3                         0.0  49.512778  53.612321   182.0     0.0  \n",
       "4                         0.0  51.150000  59.230052   206.0     0.0  \n",
       "\n",
       "[5 rows x 65 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Created 40 new features.\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>age_sq</th>\n",
       "      <th>age_log</th>\n",
       "      <th>alcohol_consumption_per_week_sq</th>\n",
       "      <th>alcohol_consumption_per_week_log</th>\n",
       "      <th>physical_activity_minutes_per_week_sq</th>\n",
       "      <th>physical_activity_minutes_per_week_log</th>\n",
       "      <th>diet_score_sq</th>\n",
       "      <th>diet_score_log</th>\n",
       "      <th>sleep_hours_per_day_sq</th>\n",
       "      <th>sleep_hours_per_day_log</th>\n",
       "      <th>...</th>\n",
       "      <th>family_history_diabetes_sq</th>\n",
       "      <th>family_history_diabetes_log</th>\n",
       "      <th>hypertension_history_sq</th>\n",
       "      <th>hypertension_history_log</th>\n",
       "      <th>cardiovascular_history_sq</th>\n",
       "      <th>cardiovascular_history_log</th>\n",
       "      <th>row_mean</th>\n",
       "      <th>row_std</th>\n",
       "      <th>row_max</th>\n",
       "      <th>row_min</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>961</td>\n",
       "      <td>3.465736</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>2025</td>\n",
       "      <td>3.828641</td>\n",
       "      <td>59.29</td>\n",
       "      <td>2.163323</td>\n",
       "      <td>46.24</td>\n",
       "      <td>2.054124</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>47.162778</td>\n",
       "      <td>55.232806</td>\n",
       "      <td>199.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2500</td>\n",
       "      <td>3.931826</td>\n",
       "      <td>4</td>\n",
       "      <td>1.098612</td>\n",
       "      <td>5329</td>\n",
       "      <td>4.304065</td>\n",
       "      <td>32.49</td>\n",
       "      <td>1.902108</td>\n",
       "      <td>42.25</td>\n",
       "      <td>2.014903</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>51.646111</td>\n",
       "      <td>58.402626</td>\n",
       "      <td>199.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1024</td>\n",
       "      <td>3.496508</td>\n",
       "      <td>9</td>\n",
       "      <td>1.386294</td>\n",
       "      <td>24964</td>\n",
       "      <td>5.068904</td>\n",
       "      <td>72.25</td>\n",
       "      <td>2.251292</td>\n",
       "      <td>54.76</td>\n",
       "      <td>2.128232</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>53.829444</td>\n",
       "      <td>59.602287</td>\n",
       "      <td>188.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2916</td>\n",
       "      <td>4.007333</td>\n",
       "      <td>9</td>\n",
       "      <td>1.386294</td>\n",
       "      <td>5929</td>\n",
       "      <td>4.356709</td>\n",
       "      <td>21.16</td>\n",
       "      <td>1.722767</td>\n",
       "      <td>49.00</td>\n",
       "      <td>2.079442</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>49.512778</td>\n",
       "      <td>53.612321</td>\n",
       "      <td>182.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2916</td>\n",
       "      <td>4.007333</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>3025</td>\n",
       "      <td>4.025352</td>\n",
       "      <td>32.49</td>\n",
       "      <td>1.902108</td>\n",
       "      <td>38.44</td>\n",
       "      <td>1.974081</td>\n",
       "      <td>...</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1</td>\n",
       "      <td>0.693147</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>51.150000</td>\n",
       "      <td>59.230052</td>\n",
       "      <td>206.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 40 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   age_sq   age_log  alcohol_consumption_per_week_sq  \\\n",
       "0     961  3.465736                                1   \n",
       "1    2500  3.931826                                4   \n",
       "2    1024  3.496508                                9   \n",
       "3    2916  4.007333                                9   \n",
       "4    2916  4.007333                                1   \n",
       "\n",
       "   alcohol_consumption_per_week_log  physical_activity_minutes_per_week_sq  \\\n",
       "0                          0.693147                                   2025   \n",
       "1                          1.098612                                   5329   \n",
       "2                          1.386294                                  24964   \n",
       "3                          1.386294                                   5929   \n",
       "4                          0.693147                                   3025   \n",
       "\n",
       "   physical_activity_minutes_per_week_log  diet_score_sq  diet_score_log  \\\n",
       "0                                3.828641          59.29        2.163323   \n",
       "1                                4.304065          32.49        1.902108   \n",
       "2                                5.068904          72.25        2.251292   \n",
       "3                                4.356709          21.16        1.722767   \n",
       "4                                4.025352          32.49        1.902108   \n",
       "\n",
       "   sleep_hours_per_day_sq  sleep_hours_per_day_log  ...  \\\n",
       "0                   46.24                 2.054124  ...   \n",
       "1                   42.25                 2.014903  ...   \n",
       "2                   54.76                 2.128232  ...   \n",
       "3                   49.00                 2.079442  ...   \n",
       "4                   38.44                 1.974081  ...   \n",
       "\n",
       "   family_history_diabetes_sq  family_history_diabetes_log  \\\n",
       "0                           0                          0.0   \n",
       "1                           0                          0.0   \n",
       "2                           0                          0.0   \n",
       "3                           0                          0.0   \n",
       "4                           0                          0.0   \n",
       "\n",
       "   hypertension_history_sq  hypertension_history_log  \\\n",
       "0                        0                  0.000000   \n",
       "1                        0                  0.000000   \n",
       "2                        0                  0.000000   \n",
       "3                        1                  0.693147   \n",
       "4                        1                  0.693147   \n",
       "\n",
       "   cardiovascular_history_sq  cardiovascular_history_log   row_mean  \\\n",
       "0                          0                         0.0  47.162778   \n",
       "1                          0                         0.0  51.646111   \n",
       "2                          0                         0.0  53.829444   \n",
       "3                          0                         0.0  49.512778   \n",
       "4                          0                         0.0  51.150000   \n",
       "\n",
       "     row_std  row_max  row_min  \n",
       "0  55.232806    199.0      0.0  \n",
       "1  58.402626    199.0      0.0  \n",
       "2  59.602287    188.0      0.0  \n",
       "3  53.612321    182.0      0.0  \n",
       "4  59.230052    206.0      0.0  \n",
       "\n",
       "[5 rows x 40 columns]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "# Check how many columns you have now (it should be a lot more!)\n",
    "print(f\"New shape of X: {X.shape}\")\n",
    "\n",
    "# See the first few rows and focus on the new columns\n",
    "display(X.head())\n",
    "\n",
    "# Look at just the new columns you created\n",
    "new_cols = [c for c in X.columns if \"_sq\" in c or \"_log\" in c or \"row_\" in c]\n",
    "print(f\"Created {len(new_cols)} new features.\")\n",
    "display(X[new_cols].head())"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "66806f6f",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:32.353284Z",
     "iopub.status.busy": "2025-12-30T18:13:32.353036Z",
     "iopub.status.idle": "2025-12-30T18:13:32.744132Z",
     "shell.execute_reply": "2025-12-30T18:13:32.743518Z"
    },
    "papermill": {
     "duration": 0.396635,
     "end_time": "2025-12-30T18:13:32.745811",
     "exception": false,
     "start_time": "2025-12-30T18:13:32.349176",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# -----------------------------\n",
    "# 4. CATEGORICAL ENCODING\n",
    "# -----------------------------\n",
    "cat_cols = X.select_dtypes(include=['object']).columns.tolist()\n",
    "for col in cat_cols:\n",
    "    X[col] = X[col].astype('category').cat.codes\n",
    "    X_test[col] = X_test[col].astype('category').cat.codes"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "85d13dae",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:32.753618Z",
     "iopub.status.busy": "2025-12-30T18:13:32.753330Z",
     "iopub.status.idle": "2025-12-30T18:13:32.759175Z",
     "shell.execute_reply": "2025-12-30T18:13:32.758667Z"
    },
    "papermill": {
     "duration": 0.011274,
     "end_time": "2025-12-30T18:13:32.760503",
     "exception": false,
     "start_time": "2025-12-30T18:13:32.749229",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "# -----------------------------\n",
    "# 5. CROSS-VALIDATION SETUP\n",
    "# -----------------------------\n",
    "# Reduced to 5 folds for better speed-to-performance ratio\n",
    "skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n",
    "\n",
    "lgb_oof = np.zeros(len(train))\n",
    "lgb_test = np.zeros(len(test))\n",
    "xgb_oof = np.zeros(len(train))\n",
    "xgb_test = np.zeros(len(test))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "9a420dd8",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:13:32.767839Z",
     "iopub.status.busy": "2025-12-30T18:13:32.767572Z",
     "iopub.status.idle": "2025-12-30T18:32:34.499041Z",
     "shell.execute_reply": "2025-12-30T18:32:34.498218Z"
    },
    "papermill": {
     "duration": 1141.737155,
     "end_time": "2025-12-30T18:32:34.500797",
     "exception": false,
     "start_time": "2025-12-30T18:13:32.763642",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "--- Starting Fold 1 (Using P100 GPU) ---\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n",
      "1 warning generated.\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Training until validation scores don't improve for 200 rounds\n",
      "[200]\tvalid_0's binary_logloss: 0.595582\n",
      "[400]\tvalid_0's binary_logloss: 0.587736\n",
      "[600]\tvalid_0's binary_logloss: 0.585227\n",
      "[800]\tvalid_0's binary_logloss: 0.584168\n",
      "[1000]\tvalid_0's binary_logloss: 0.583803\n",
      "[1200]\tvalid_0's binary_logloss: 0.583543\n",
      "[1400]\tvalid_0's binary_logloss: 0.583364\n",
      "[1600]\tvalid_0's binary_logloss: 0.583232\n",
      "[1800]\tvalid_0's binary_logloss: 0.583177\n",
      "[2000]\tvalid_0's binary_logloss: 0.583085\n",
      "[2200]\tvalid_0's binary_logloss: 0.583048\n",
      "[2400]\tvalid_0's binary_logloss: 0.583002\n",
      "Early stopping, best iteration is:\n",
      "[2372]\tvalid_0's binary_logloss: 0.582986\n",
      "[0]\tvalidation_0-logloss:0.66137\n",
      "[200]\tvalidation_0-logloss:0.60010\n",
      "[400]\tvalidation_0-logloss:0.59357\n",
      "[600]\tvalidation_0-logloss:0.59053\n",
      "[800]\tvalidation_0-logloss:0.58871\n",
      "[1000]\tvalidation_0-logloss:0.58742\n",
      "[1200]\tvalidation_0-logloss:0.58636\n",
      "[1400]\tvalidation_0-logloss:0.58570\n",
      "[1600]\tvalidation_0-logloss:0.58523\n",
      "[1800]\tvalidation_0-logloss:0.58491\n",
      "[2000]\tvalidation_0-logloss:0.58466\n",
      "[2200]\tvalidation_0-logloss:0.58448\n",
      "[2400]\tvalidation_0-logloss:0.58436\n",
      "[2600]\tvalidation_0-logloss:0.58418\n",
      "[2800]\tvalidation_0-logloss:0.58408\n",
      "[2999]\tvalidation_0-logloss:0.58401\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/usr/local/lib/python3.12/dist-packages/xgboost/core.py:774: UserWarning: [18:17:12] WARNING: /workspace/src/common/error_msg.cc:41: Falling back to prediction using DMatrix due to mismatched devices. This might lead to higher memory usage and slower performance. XGBoost is running on: cuda:0, while the input data is on: cpu.\n",
      "Potential solutions:\n",
      "- Use a data structure that matches the device ordinal in the booster.\n",
      "- Set the device for booster before call to inplace_predict.\n",
      "\n",
      "This warning will only be shown once.\n",
      "\n",
      "  return func(**kwargs)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Fold 1 Summary | LGBM AUC: 0.72676 | XGB AUC: 0.72555\n",
      "\n",
      "--- Starting Fold 2 (Using P100 GPU) ---\n",
      "Training until validation scores don't improve for 200 rounds\n",
      "[200]\tvalid_0's binary_logloss: 0.595955\n",
      "[400]\tvalid_0's binary_logloss: 0.588931\n",
      "[600]\tvalid_0's binary_logloss: 0.586477\n",
      "[800]\tvalid_0's binary_logloss: 0.585443\n",
      "[1000]\tvalid_0's binary_logloss: 0.584957\n",
      "[1200]\tvalid_0's binary_logloss: 0.584857\n",
      "[1400]\tvalid_0's binary_logloss: 0.584639\n",
      "[1600]\tvalid_0's binary_logloss: 0.584524\n",
      "[1800]\tvalid_0's binary_logloss: 0.584414\n",
      "[2000]\tvalid_0's binary_logloss: 0.584374\n",
      "[2200]\tvalid_0's binary_logloss: 0.584321\n",
      "[2400]\tvalid_0's binary_logloss: 0.584334\n",
      "Early stopping, best iteration is:\n",
      "[2253]\tvalid_0's binary_logloss: 0.584308\n",
      "[0]\tvalidation_0-logloss:0.66137\n",
      "[200]\tvalidation_0-logloss:0.60058\n",
      "[400]\tvalidation_0-logloss:0.59386\n",
      "[600]\tvalidation_0-logloss:0.59101\n",
      "[800]\tvalidation_0-logloss:0.58930\n",
      "[1000]\tvalidation_0-logloss:0.58807\n",
      "[1200]\tvalidation_0-logloss:0.58720\n",
      "[1400]\tvalidation_0-logloss:0.58669\n",
      "[1600]\tvalidation_0-logloss:0.58621\n",
      "[1800]\tvalidation_0-logloss:0.58581\n",
      "[2000]\tvalidation_0-logloss:0.58553\n",
      "[2200]\tvalidation_0-logloss:0.58545\n",
      "[2400]\tvalidation_0-logloss:0.58534\n",
      "[2600]\tvalidation_0-logloss:0.58524\n",
      "[2800]\tvalidation_0-logloss:0.58514\n",
      "[2999]\tvalidation_0-logloss:0.58506\n",
      "Fold 2 Summary | LGBM AUC: 0.72469 | XGB AUC: 0.72384\n",
      "\n",
      "--- Starting Fold 3 (Using P100 GPU) ---\n",
      "Training until validation scores don't improve for 200 rounds\n",
      "[200]\tvalid_0's binary_logloss: 0.595996\n",
      "[400]\tvalid_0's binary_logloss: 0.588522\n",
      "[600]\tvalid_0's binary_logloss: 0.586078\n",
      "[800]\tvalid_0's binary_logloss: 0.584986\n",
      "[1000]\tvalid_0's binary_logloss: 0.584544\n",
      "[1200]\tvalid_0's binary_logloss: 0.584235\n",
      "[1400]\tvalid_0's binary_logloss: 0.584037\n",
      "[1600]\tvalid_0's binary_logloss: 0.583946\n",
      "[1800]\tvalid_0's binary_logloss: 0.58383\n",
      "[2000]\tvalid_0's binary_logloss: 0.583788\n",
      "[2200]\tvalid_0's binary_logloss: 0.583778\n",
      "[2400]\tvalid_0's binary_logloss: 0.583758\n",
      "Early stopping, best iteration is:\n",
      "[2322]\tvalid_0's binary_logloss: 0.583748\n",
      "[0]\tvalidation_0-logloss:0.66137\n",
      "[200]\tvalidation_0-logloss:0.60043\n",
      "[400]\tvalidation_0-logloss:0.59399\n",
      "[600]\tvalidation_0-logloss:0.59122\n",
      "[800]\tvalidation_0-logloss:0.58952\n",
      "[1000]\tvalidation_0-logloss:0.58799\n",
      "[1200]\tvalidation_0-logloss:0.58699\n",
      "[1400]\tvalidation_0-logloss:0.58641\n",
      "[1600]\tvalidation_0-logloss:0.58588\n",
      "[1800]\tvalidation_0-logloss:0.58547\n",
      "[2000]\tvalidation_0-logloss:0.58517\n",
      "[2200]\tvalidation_0-logloss:0.58498\n",
      "[2400]\tvalidation_0-logloss:0.58479\n",
      "[2600]\tvalidation_0-logloss:0.58466\n",
      "[2800]\tvalidation_0-logloss:0.58463\n",
      "[2999]\tvalidation_0-logloss:0.58457\n",
      "Fold 3 Summary | LGBM AUC: 0.72559 | XGB AUC: 0.72449\n",
      "\n",
      "--- Starting Fold 4 (Using P100 GPU) ---\n",
      "Training until validation scores don't improve for 200 rounds\n",
      "[200]\tvalid_0's binary_logloss: 0.595698\n",
      "[400]\tvalid_0's binary_logloss: 0.588134\n",
      "[600]\tvalid_0's binary_logloss: 0.585432\n",
      "[800]\tvalid_0's binary_logloss: 0.584462\n",
      "[1000]\tvalid_0's binary_logloss: 0.583976\n",
      "[1200]\tvalid_0's binary_logloss: 0.583735\n",
      "[1400]\tvalid_0's binary_logloss: 0.583494\n",
      "[1600]\tvalid_0's binary_logloss: 0.583359\n",
      "[1800]\tvalid_0's binary_logloss: 0.583311\n",
      "[2000]\tvalid_0's binary_logloss: 0.583255\n",
      "[2200]\tvalid_0's binary_logloss: 0.58315\n",
      "[2400]\tvalid_0's binary_logloss: 0.583049\n",
      "[2600]\tvalid_0's binary_logloss: 0.583026\n",
      "[2800]\tvalid_0's binary_logloss: 0.582915\n",
      "[3000]\tvalid_0's binary_logloss: 0.58288\n",
      "[3200]\tvalid_0's binary_logloss: 0.58289\n",
      "Early stopping, best iteration is:\n",
      "[3040]\tvalid_0's binary_logloss: 0.582868\n",
      "[0]\tvalidation_0-logloss:0.66137\n",
      "[200]\tvalidation_0-logloss:0.60002\n",
      "[400]\tvalidation_0-logloss:0.59309\n",
      "[600]\tvalidation_0-logloss:0.59028\n",
      "[800]\tvalidation_0-logloss:0.58830\n",
      "[1000]\tvalidation_0-logloss:0.58689\n",
      "[1200]\tvalidation_0-logloss:0.58601\n",
      "[1400]\tvalidation_0-logloss:0.58539\n",
      "[1600]\tvalidation_0-logloss:0.58492\n",
      "[1800]\tvalidation_0-logloss:0.58457\n",
      "[2000]\tvalidation_0-logloss:0.58425\n",
      "[2200]\tvalidation_0-logloss:0.58404\n",
      "[2400]\tvalidation_0-logloss:0.58384\n",
      "[2600]\tvalidation_0-logloss:0.58367\n",
      "[2800]\tvalidation_0-logloss:0.58349\n",
      "[2999]\tvalidation_0-logloss:0.58338\n",
      "Fold 4 Summary | LGBM AUC: 0.72667 | XGB AUC: 0.72611\n",
      "\n",
      "--- Starting Fold 5 (Using P100 GPU) ---\n",
      "Training until validation scores don't improve for 200 rounds\n",
      "[200]\tvalid_0's binary_logloss: 0.595738\n",
      "[400]\tvalid_0's binary_logloss: 0.588375\n",
      "[600]\tvalid_0's binary_logloss: 0.585596\n",
      "[800]\tvalid_0's binary_logloss: 0.584741\n",
      "[1000]\tvalid_0's binary_logloss: 0.584213\n",
      "[1200]\tvalid_0's binary_logloss: 0.583862\n",
      "[1400]\tvalid_0's binary_logloss: 0.583654\n",
      "[1600]\tvalid_0's binary_logloss: 0.583499\n",
      "[1800]\tvalid_0's binary_logloss: 0.583472\n",
      "[2000]\tvalid_0's binary_logloss: 0.583428\n",
      "[2200]\tvalid_0's binary_logloss: 0.583358\n",
      "[2400]\tvalid_0's binary_logloss: 0.583349\n",
      "[2600]\tvalid_0's binary_logloss: 0.583316\n",
      "[2800]\tvalid_0's binary_logloss: 0.583337\n",
      "Early stopping, best iteration is:\n",
      "[2668]\tvalid_0's binary_logloss: 0.583309\n",
      "[0]\tvalidation_0-logloss:0.66138\n",
      "[200]\tvalidation_0-logloss:0.60029\n",
      "[400]\tvalidation_0-logloss:0.59338\n",
      "[600]\tvalidation_0-logloss:0.59061\n",
      "[800]\tvalidation_0-logloss:0.58906\n",
      "[1000]\tvalidation_0-logloss:0.58754\n",
      "[1200]\tvalidation_0-logloss:0.58667\n",
      "[1400]\tvalidation_0-logloss:0.58595\n",
      "[1600]\tvalidation_0-logloss:0.58543\n",
      "[1800]\tvalidation_0-logloss:0.58494\n",
      "[2000]\tvalidation_0-logloss:0.58465\n",
      "[2200]\tvalidation_0-logloss:0.58445\n",
      "[2400]\tvalidation_0-logloss:0.58429\n",
      "[2600]\tvalidation_0-logloss:0.58418\n",
      "[2800]\tvalidation_0-logloss:0.58410\n",
      "[2999]\tvalidation_0-logloss:0.58406\n",
      "Fold 5 Summary | LGBM AUC: 0.72634 | XGB AUC: 0.72541\n"
     ]
    }
   ],
   "source": [
    "# -----------------------------\n",
    "# 6. TRAINING LOOP (FIXED & GPU OPTIMIZED)\n",
    "# -----------------------------\n",
    "for fold, (tr, val) in enumerate(skf.split(X, y)):\n",
    "    print(f\"\\n--- Starting Fold {fold+1} (Using P100 GPU) ---\")\n",
    "    \n",
    "    X_tr, X_val = X.iloc[tr], X.iloc[val]\n",
    "    y_tr, y_val = y.iloc[tr], y.iloc[val]\n",
    "\n",
    "    # --- LightGBM (GPU) ---\n",
    "    l_model = lgb.LGBMClassifier(\n",
    "        n_estimators=5000,\n",
    "        learning_rate=0.01, # Faster learning rate\n",
    "        num_leaves=128,\n",
    "        device=\"gpu\",\n",
    "        gpu_platform_id=0,\n",
    "        gpu_device_id=0,\n",
    "        objective=\"binary\",\n",
    "        random_state=42,\n",
    "        verbosity=-1\n",
    "    )\n",
    "    l_model.fit(\n",
    "        X_tr, y_tr,\n",
    "        eval_set=[(X_val, y_val)],\n",
    "        callbacks=[lgb.early_stopping(200), lgb.log_evaluation(period=200)]\n",
    "    )\n",
    "    lgb_oof[val] = l_model.predict_proba(X_val)[:, 1]\n",
    "    lgb_test += l_model.predict_proba(X_test)[:, 1] / skf.n_splits\n",
    "\n",
    "   # --- XGBoost (GPU - UPDATED FOR VERSION 2.0+) ---\n",
    "    x_model = xgb.XGBClassifier(\n",
    "        n_estimators=3000,\n",
    "        learning_rate=0.01,\n",
    "        max_depth=7,\n",
    "        # CHANGE THESE TWO LINES:\n",
    "        tree_method=\"hist\", \n",
    "        device=\"cuda\", \n",
    "        # ------------------------\n",
    "        enable_categorical=True,\n",
    "        random_state=42,\n",
    "        early_stopping_rounds=100 \n",
    "    )\n",
    "    x_model.fit(\n",
    "        X_tr, y_tr,\n",
    "        eval_set=[(X_val, y_val)],\n",
    "        verbose=200 # Now printing every 200 rounds so you see progress\n",
    "    )\n",
    "    xgb_oof[val] = x_model.predict_proba(X_val)[:, 1]\n",
    "    xgb_test += x_model.predict_proba(X_test)[:, 1] / skf.n_splits\n",
    "    \n",
    "    l_auc = roc_auc_score(y_val, lgb_oof[val])\n",
    "    x_auc = roc_auc_score(y_val, xgb_oof[val])\n",
    "    print(f\"Fold {fold+1} Summary | LGBM AUC: {l_auc:.5f} | XGB AUC: {x_auc:.5f}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "5f0077e5",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:32:34.520911Z",
     "iopub.status.busy": "2025-12-30T18:32:34.520648Z",
     "iopub.status.idle": "2025-12-30T18:32:35.012350Z",
     "shell.execute_reply": "2025-12-30T18:32:35.011542Z"
    },
    "papermill": {
     "duration": 0.503487,
     "end_time": "2025-12-30T18:32:35.013929",
     "exception": false,
     "start_time": "2025-12-30T18:32:34.510442",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "========================================\n",
      "Total LGBM CV AUC: 0.72601\n",
      "Total XGB CV AUC:  0.72507\n",
      "Ensemble CV AUC:   0.72634\n",
      "========================================\n"
     ]
    }
   ],
   "source": [
    "# 7. FINAL SCORES AND BLENDING\n",
    "# -----------------------------\n",
    "print(\"\\n\" + \"=\"*40)\n",
    "print(f\"Total LGBM CV AUC: {roc_auc_score(y, lgb_oof):.5f}\")\n",
    "print(f\"Total XGB CV AUC:  {roc_auc_score(y, xgb_oof):.5f}\")\n",
    "\n",
    "# Weighted Blend (LGBM often performs slightly better on this dataset)\n",
    "final_oof = (0.6 * lgb_oof) + (0.4 * xgb_oof)\n",
    "print(f\"Ensemble CV AUC:   {roc_auc_score(y, final_oof):.5f}\")\n",
    "print(\"=\"*40)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "bbeb7b6e",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-12-30T18:32:35.033519Z",
     "iopub.status.busy": "2025-12-30T18:32:35.033264Z",
     "iopub.status.idle": "2025-12-30T18:32:35.569745Z",
     "shell.execute_reply": "2025-12-30T18:32:35.568923Z"
    },
    "papermill": {
     "duration": 0.547871,
     "end_time": "2025-12-30T18:32:35.571233",
     "exception": false,
     "start_time": "2025-12-30T18:32:35.023362",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Submission saved successfully!\n"
     ]
    }
   ],
   "source": [
    "# -----------------------------\n",
    "# 8. SUBMISSION\n",
    "# -----------------------------\n",
    "submission = pd.DataFrame({\n",
    "    ID_COL: test[ID_COL],\n",
    "    TARGET: (0.6 * lgb_test) + (0.4 * xgb_test)\n",
    "})\n",
    "submission.to_csv(\"submission.csv\", index=False)\n",
    "print(\"Submission saved successfully!\")"
   ]
  }
 ],
 "metadata": {
  "kaggle": {
   "accelerator": "gpu",
   "dataSources": [
    {
     "databundleVersionId": 14272474,
     "sourceId": 91723,
     "sourceType": "competition"
    }
   ],
   "dockerImageVersionId": 31236,
   "isGpuEnabled": true,
   "isInternetEnabled": false,
   "language": "python",
   "sourceType": "notebook"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.12"
  },
  "papermill": {
   "default_parameters": {},
   "duration": 1160.644869,
   "end_time": "2025-12-30T18:32:36.499842",
   "environment_variables": {},
   "exception": null,
   "input_path": "__notebook__.ipynb",
   "output_path": "__notebook__.ipynb",
   "parameters": {},
   "start_time": "2025-12-30T18:13:15.854973",
   "version": "2.6.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
